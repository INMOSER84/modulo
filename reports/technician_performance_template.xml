<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Plantilla de reporte de rendimiento de técnico -->
        <template id="report_technician_performance_document">
            <t t-call="web.html_container">
                <t t-call="web.external_layout">
                    <div class="page">
                        <!-- Encabezado -->
                        <div class="text-center mb-4">
                            <h1>Technician Performance Report</h1>
                            <div class="d-inline-block border rounded p-2 bg-primary text-white">
                                <strong>Technician:</strong> <span t-field="doc.name"/>
                            </div>
                        </div>
                        
                        <!-- Información Principal -->
                        <div class="row mt-4 mb-4">
                            <div class="col-6">
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="card-title mb-0">Technician Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Employee ID:</strong></div>
                                            <div class="col-7"><span t-field="doc.identification_id"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Department:</strong></div>
                                            <div class="col-7"><span t-field="doc.department_id.name"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Specialization:</strong></div>
                                            <div class="col-7"><span t-field="doc.specialization"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Certification:</strong></div>
                                            <div class="col-7"><span t-field="doc.certification"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Technician Code:</strong></div>
                                            <div class="col-7"><span t-field="doc.technician_code"/></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="card-title mb-0">Report Information</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Report Period:</strong></div>
                                            <div class="col-7"><t t-esc="start_date"/> to <t t-esc="end_date"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Report Date:</strong></div>
                                            <div class="col-7"><t t-esc="datetime.datetime.now().strftime('%Y-%m-%d')"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Generated By:</strong></div>
                                            <div class="col-7"><span t-field="doc.create_uid.name"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Work Phone:</strong></div>
                                            <div class="col-7"><span t-field="doc.work_phone"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-5"><strong>Work Email:</strong></div>
                                            <div class="col-7"><span t-field="doc.work_email"/></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Métricas de Rendimiento -->
                        <div class="card mt-4 mb-4">
                            <div class="card-header bg-info text-white">
                                <h5 class="card-title mb-0">Performance Metrics</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-3 text-center">
                                        <div class="card border-primary">
                                            <div class="card-body">
                                                <h5 class="card-title">Completed Orders</h5>
                                                <p class="card-text display-4"><t t-esc="completed_orders_count"/></p>
                                                <small class="text-muted">Total completed</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <div class="card border-success">
                                            <div class="card-body">
                                                <h5 class="card-title">Average Time</h5>
                                                <p class="card-text display-4"><t t-esc="avg_completion_time"/>h</p>
                                                <small class="text-muted">Hours per order</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <div class="card border-warning">
                                            <div class="card-body">
                                                <h5 class="card-title">Customer Satisfaction</h5>
                                                <p class="card-text display-4"><t t-esc="customer_satisfaction"/>%</p>
                                                <small class="text-muted">Average rating</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <div class="card border-danger">
                                            <div class="card-body">
                                                <h5 class="card-title">Efficiency</h5>
                                                <p class="card-text display-4"><t t-esc="efficiency"/>%</p>
                                                <small class="text-muted">Performance rate</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Gráfico de Rendimiento por Tipo de Servicio -->
                        <div class="card mt-4 mb-4">
                            <div class="card-header bg-warning text-dark">
                                <h5 class="card-title mb-0">Service Type Performance</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <h6>Orders by Service Type</h6>
                                        <table class="table table-sm table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Service Type</th>
                                                    <th>Count</th>
                                                    <th>Percentage</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr t-foreach="service_type_stats" t-as="stat">
                                                    <td><span t-field="stat.name"/></td>
                                                    <td><span t-field="stat.count"/></td>
                                                    <td><span t-esc="round(stat.percentage, 1)"/>%</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="col-6">
                                        <h6>Performance by Service Type</h6>
                                        <table class="table table-sm table-bordered">
                                            <thead>
                                                <tr>
                                                    <th>Service Type</th>
                                                    <th>Avg Time</th>
                                                    <th>Satisfaction</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr t-foreach="service_type_performance" t-as="perf">
                                                    <td><span t-field="perf.name"/></td>
                                                    <td><span t-field="perf.avg_time"/>h</td>
                                                    <td><span t-field="perf.satisfaction"/>%</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Órdenes de Servicio -->
                        <div class="card mt-4 mb-4">
                            <div class="card-header bg-secondary text-white">
                                <h5 class="card-title mb-0">Service Orders Details</h5>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm table-bordered">
                                    <thead>
                                        <tr>
                                            <th>Order Reference</th>
                                            <th>Date</th>
                                            <th>Service Type</th>
                                            <th>Equipment</th>
                                            <th>Duration (h)</th>
                                            <th>Status</th>
                                            <th>Customer Satisfaction</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr t-foreach="service_orders" t-as="order">
                                            <td><span t-field="order.name"/></td>
                                            <td><span t-field="order.date_requested"/></td>
                                            <td><span t-field="order.service_type_id.name"/></td>
                                            <td><span t-field="order.equipment_id.name"/></td>
                                            <td><span t-field="order.duration"/></td>
                                            <td>
                                                <span class="badge" t-att-class="{
                                                    'bg-success': order.state == 'completed',
                                                    'bg-warning': order.state in ('scheduled', 'in_progress'),
                                                    'bg-info': order.state == 'draft',
                                                    'bg-danger': order.state == 'cancelled'
                                                }">
                                                    <span t-field="order.state"/>
                                                </span>
                                            </td>
                                            <td>
                                                <t t-if="order.customer_satisfaction">
                                                    <span class="badge bg-primary"><span t-field="order.customer_satisfaction"/>/5</span>
                                                </t>
                                                <t t-else="">
                                                    <span class="badge bg-secondary">N/A</span>
                                                </t>
                                            </td>
                                        </tr>
                                        <t t-if="not service_orders">
                                            <tr>
                                                <td colspan="8" class="text-center">No service orders found in the period</td>
                                            </tr>
                                        </t>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Resumen de Calidad -->
                        <div class="row mt-4 mb-4">
                            <div class="col-6">
                                <div class="card">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="card-title mb-0">Quality Metrics</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-2">
                                            <div class="col-6"><strong>First Time Fix:</strong></div>
                                            <div class="col-6"><t t-esc="first_time_fix_rate"/>%</div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-6"><strong>Repeat Calls:</strong></div>
                                            <div class="col-6"><t t-esc="repeat_calls"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-6"><strong>On-time Completion:</strong></div>
                                            <div class="col-6"><t t-esc="on_time_completion_rate"/>%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="card">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="card-title mb-0">Productivity</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row mb-2">
                                            <div class="col-6"><strong>Orders per Day:</strong></div>
                                            <div class="col-6"><t t-esc="orders_per_day"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-6"><strong>Revenue Generated:</strong></div>
                                            <div class="col-6">$<t t-esc="revenue_generated"/></div>
                                        </div>
                                        <div class="row mb-2">
                                            <div class="col-6"><strong>Utilization Rate:</strong></div>
                                            <div class="col-6"><t t-esc="utilization_rate"/>%</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Comentarios y Observaciones -->
                        <div class="card mt-4 mb-4">
                            <div class="card-header bg-dark text-white">
                                <h5 class="card-title mb-0">Comments &amp; Observations</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6">
                                        <h6>Strengths</h6>
                                        <ul>
                                            <li t-foreach="strengths" t-as="strength">
                                                <span t-field="strength"/>
                                            </li>
                                            <t t-if="not strengths">
                                                <li>No specific strengths identified</li>
                                            </t>
                                        </ul>
                                    </div>
                                    <div class="col-6">
                                        <h6>Areas for Improvement</h6>
                                        <ul>
                                            <li t-foreach="improvements" t-as="improvement">
                                                <span t-field="improvement"/>
                                            </li>
                                            <t t-if="not improvements">
                                                <li>No specific areas for improvement</li>
                                            </t>
                                        </ul>
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <h6>Overall Assessment</h6>
                                        <p><t t-esc="overall_assessment"/></p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pie de página -->
                        <div class="text-center mt-4">
                            <small class="text-muted">
                                Generated on <t t-esc="datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')"/>
                            </small>
                        </div>
                    </div>
                </t>
            </t>
        </template>

        <!-- Acción de reporte -->
        <record id="action_report_technician_performance" model="ir.actions.report">
            <field name="name">Technician Performance</field>
            <field name="model">hr.employee</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">modulo.report_technician_performance_document</field>
            <field name="report_file">modulo.report_technician_performance_document</field>
            <field name="binding_model_id" ref="hr.model_hr_employee"/>
            <field name="binding_type">report</field>
            <field name="print_report_name">'Technician Performance - %s' % (object.name)</field>
        </record>
    </data>
</odoo>
